generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model area_atuacao {
  id                     Int                      @id @default(autoincrement())
  nome                   String                   @db.VarChar(100)
}

model cargo {
  id              Int               @id @default(autoincrement())
  nome            String            @db.VarChar(100)
}

model cliente {
  id                  String                @id @db.Char(36) @unique
  nome                String                @db.VarChar(150)
  data_nascimento     DateTime              @db.Date
  email_contato       String                @unique(map: "email_contato_UNIQUE") @db.VarChar(255)
  data_entrada        DateTime              @db.Date
  data_saida          DateTime?             @db.Date
  status              cliente_status        @default(ativo)
  perfil_acesso       String                @db.VarChar(20)
  senha               String?               @db.VarChar(255)
  token_redefinicao   String?               @db.Char(36)
  validade_token      DateTime?             @db.DateTime(0)
  criado_em           DateTime              @default(now())
  atualizado_em       DateTime              @updatedAt
  cliente_endereco    cliente_endereco[]
  cliente_escola      cliente_escola[]
  cliente_responsavel cliente_responsavel[]
  pagamentos          pagamentos[]
  ocp                 ocp[]
  terapeuta           terapeuta_cliente[]
  sessao                 sessao[]

  @@index([nome], map: "nome_idx")
}

model cliente_endereco {
  id               Int           @id @default(autoincrement())
  cliente_id       String        @db.Char(36)
  endereco_id      Int
  tipo_endereco_id Int
  principal        Int           @default(0) @db.TinyInt
  criado_em        DateTime      @default(now())
  atualizado_em    DateTime      @updatedAt
  tipo_endereco    tipo_endereco @relation(fields: [tipo_endereco_id], references: [id], onUpdate: NoAction, map: "fk_cliente_endereco_tipo_endereco1")
  cliente          cliente       @relation(fields: [cliente_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_cliente_has_endereco_cliente1")
  endereco         endereco      @relation(fields: [endereco_id], references: [id], onUpdate: NoAction, map: "fk_cliente_has_endereco_endereco1")

  @@unique([cliente_id, endereco_id, tipo_endereco_id], map: "uk_cli_end_tipo")
  @@index([cliente_id, principal], map: "cliente_principal_idx")
  @@index([tipo_endereco_id], map: "fk_cliente_endereco_tipo_endereco1_idx")
  @@index([cliente_id], map: "fk_cliente_has_endereco_cliente1_idx")
  @@index([endereco_id], map: "fk_cliente_has_endereco_endereco1_idx")
}

model cliente_escola {
  id         Int     @id @default(autoincrement())
  cliente_id String  @db.Char(36)
  escola_id  Int
  cliente    cliente @relation(fields: [cliente_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_cliente_has_escola_cliente1")
  escola     escola  @relation(fields: [escola_id], references: [id], onUpdate: NoAction, map: "fk_cliente_has_escola_escola1")

  @@unique([cliente_id, escola_id], map: "cliente_escola")
  @@index([cliente_id], map: "fk_cliente_has_escolas_cliente1_idx")
  @@index([escola_id], map: "fk_cliente_has_escolas_escola1_idx")
}

model cliente_responsavel {
  cliente_id      String                         @db.Char(36)
  responsaveis_id Int
  parentesco      cliente_responsavel_parentesco
  prioridade      Int                            @default(1) @db.TinyInt
  cliente         cliente                        @relation(fields: [cliente_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_cliente_has_responsaveis_cliente1")
  responsaveis    responsaveis                   @relation(fields: [responsaveis_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_cliente_has_responsaveis_responsaveis1")

  @@id([cliente_id, responsaveis_id])
  @@index([cliente_id], map: "fk_cliente_has_responsaveis_cliente1_idx")
  @@index([responsaveis_id], map: "fk_cliente_has_responsaveis_responsaveis1_idx")
  @@index([parentesco], map: "parentesco_idx")
}

model documentos_terapeuta {
  id              Int       @id @default(autoincrement())
  terapeuta_id    String    
  tipo_documento  String    
  view_url        String
  download_url    String
  data_upload     DateTime  @db.Date
  terapeuta       terapeuta @relation(fields: [terapeuta_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_documentos_terapeuta_terapeuta1")

  @@index([terapeuta_id], map: "fk_documentos_terapeuta_terapeuta1_idx")
}

model endereco {
  id                        Int                  @id @default(autoincrement())
  cep                       String               @db.Char(8)
  rua                       String               @db.VarChar(255)
  numero                    String               @db.VarChar(10)
  bairro                    String               @db.VarChar(100)
  cidade                    String               @db.VarChar(100)
  uf                        String               @db.Char(2)
  complemento               String?              @db.VarChar(100)
  criado_em                 DateTime             @default(now())
  atualizado_em             DateTime             @updatedAt
  terapeuta_endereco        terapeuta[]
  pessoa_juridica           pessoa_juridica[]
  cliente_endereco          cliente_endereco[]
  escola_endereco           escola_endereco[]

  @@index([cep])
  @@index([cidade, uf])
}

model escola {
  id              Int                @id @default(autoincrement())
  tipo_escola     escola_tipo_escola
  nome            String             @db.VarChar(150)
  telefone        String             @db.VarChar(20)
  email           String             @db.VarChar(255)
  criado_em       DateTime           @default(now())
  atualizado_em   DateTime           @updatedAt
  cliente_escola  cliente_escola[]
  escola_endereco escola_endereco[]
}

model escola_endereco {
  id               Int           @id @default(autoincrement())
  escola_id        Int
  endereco_id      Int
  tipo_endereco_id Int
  principal        Int           @default(0) @db.TinyInt
  criado_em        DateTime      @default(now())
  atualizado_em    DateTime      @updatedAt
  tipo_endereco    tipo_endereco @relation(fields: [tipo_endereco_id], references: [id], onUpdate: NoAction, map: "fk_escola_endereco_tipo_endereco1")
  endereco         endereco      @relation(fields: [endereco_id], references: [id], onUpdate: NoAction, map: "fk_escola_has_endereco_endereco1")
  escola           escola        @relation(fields: [escola_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_escola_has_endereco_escola1")

  @@unique([escola_id, endereco_id, tipo_endereco_id], map: "uk_esc_end_tipo")
  @@index([escola_id, principal], map: "escola_principal_idx")
  @@index([tipo_endereco_id], map: "fk_escola_endereco_tipo_endereco1_idx")
  @@index([endereco_id], map: "fk_escola_has_endereco_endereco1_idx")
  @@index([escola_id], map: "fk_escola_has_endereco_escola1_idx")
}

model pagamento_contatos {
  contato_id    Int                          @id @default(autoincrement())
  pagamentos_id Int
  categoria     pagamento_contatos_categoria @default(geral)
  tipo          pagamento_contatos_tipo
  valor         String                       @db.VarChar(45)
  pagamentos    pagamentos                   @relation(fields: [pagamentos_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_pagamento_contatos_pagamentos1")

  @@index([pagamentos_id], map: "fk_pagamento_contatos_pagamentos1_idx")
}

model pagamentos {
  id                   Int                     @id @default(autoincrement())
  cliente_id           String                  @db.Char(36)
  nome                 String?                 @db.VarChar(150)
  numero_carteirinha   String?                 @db.VarChar(50)
  tipo_sistema         pagamentos_tipo_sistema
  prazo_reembolso_dias Int?
  numero_processo      String?                 @db.VarChar(50)
  nome_advogado        String?                 @db.VarChar(150)
  valor_sessao         Decimal?                @db.Decimal(10, 2)
  criado_em            DateTime                @default(now())
  atualizado_em        DateTime                @updatedAt
  pagamento_contatos   pagamento_contatos[]
  cliente              cliente                 @relation(fields: [cliente_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_pagamentos_cliente1")

  @@index([cliente_id], map: "fk_pagamentos_cliente1_idx")
}

model responsaveis {
  id                  Int                   @id @default(autoincrement())
  nome                String                @db.VarChar(150)
  cpf                 String                @unique(map: "cpf_UNIQUE") @db.Char(11)
  telefone            String?               @db.VarChar(20)
  email               String?               @db.VarChar(255)
  criado_em           DateTime              @default(now())
  atualizado_em       DateTime              @updatedAt
  cliente_responsavel cliente_responsavel[]

  @@index([nome], map: "nome_idx")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model terapeuta {
  id                     String                   @id @default(uuid())
  nome                   String
  email                  String                   @unique
  email_indigo           String                   @unique
  celular                String
  telefone               String?
  cpf                    String                   @unique
  data_nascimento        DateTime
  possui_veiculo         Boolean                  @default(false)
  placa_veiculo          String?
  modelo_veiculo         String?
  banco                  String?
  agencia                String?
  conta                  String?
  chave_pix              String?
  valor_hora             Decimal?                 @db.Decimal(10, 2)
  professor_uni          Boolean                  @default(false)
  endereco_id            Int?
  data_entrada           DateTime
  data_saida             DateTime?
  perfil_acesso          String
  atividade              Boolean                  @default(true)
  senha                  String?                  @db.VarChar(255)
  token_redefinicao      String?
  validade_token         DateTime?
  criado_em              DateTime                 @default(now())
  atualizado_em          DateTime                 @updatedAt
  documentos_terapeuta   documentos_terapeuta[]
  registro_profissional  registro_profissional[]
  formacao               formacao[]
  endereco               endereco?                @relation(fields: [endereco_id], references: [id])
  pessoa_juridica        pessoa_juridica?
  disciplina             disciplina[]
  sessao                 sessao[]
  ocp                    ocp[]                    @relation("CriadorOcp")
  cliente                terapeuta_cliente[]

  @@index([atividade])
  @@index([nome])
}

model formacao {
  id                        Int                   @id @default(autoincrement())
  graduacao                 String?
  instituicao_graduacao     String?
  ano_formatura             Int?
  participacao_congressos   String?               @db.Text
  publicacoes_descricao     String?               @db.Text

  terapeuta_id              String
  terapeuta                 terapeuta             @relation(fields: [terapeuta_id], references: [id])
  pos_graduacao             pos_graduacao[]
}

model pos_graduacao {
  id                        Int                   @id @default(autoincrement())
  tipo                      String?
  curso                     String?
  instituicao               String?
  conclusao                 String?

  formacao_id               Int
  formacao                  formacao              @relation(fields: [formacao_id], references: [id])
}

model registro_profissional {
  id                    Int                       @id @default(autoincrement())
  area_atuacao          String
  cargo                 String?
  numero_conselho       String?
  terapeuta_id          String

  terapeuta             terapeuta                 @relation(fields: [terapeuta_id], references: [id])
  @@index([area_atuacao])
}

model pessoa_juridica {
  id                    Int                       @id @default(autoincrement())
  cnpj                  String?                    @unique
  razao_social          String?
  
  endereco_id           Int
  endereco              endereco?                 @relation(fields: [endereco_id], references: [id])

  terapeuta_id          String                    @unique
  terapeuta             terapeuta                 @relation(fields: [terapeuta_id], references: [id])
}

model disciplina {
  id          Int         @id @default(autoincrement())
  nome        String
  terapeuta   terapeuta[]
}

model tipo_endereco {
  id                 Int                  @id @default(autoincrement())
  tipo               String               @unique(map: "tipo_UNIQUE") @db.VarChar(30)
  cliente_endereco   cliente_endereco[]
  escola_endereco    escola_endereco[]
}

model sessao_trial {
  id                  Int                 @id @default(autoincrement())
  sessao_id           Int
  estimulos_ocp_id    Int
  ordem               Int
  resultado           String

  sessao              sessao              @relation(fields: [sessao_id], references: [id], onDelete: Cascade)
  estimulosOcp        estimulo_ocp        @relation(fields: [estimulos_ocp_id], references: [id], onDelete: Cascade)

  @@index([sessao_id])
  @@index([estimulos_ocp_id])
}

model sessao {
  id                  Int                 @id @default(autoincrement())
  ocp_id              Int
  cliente_id          String              @db.Char(36)
  terapeuta_id        String              @db.Char(36)
  data_criacao        DateTime            @default(now())
  criado_em           DateTime            @default(now())
  atualizado_em       DateTime            @updatedAt

  ocp                 ocp                 @relation(fields: [ocp_id], references: [id], onDelete: Cascade)
  terapeuta           terapeuta           @relation(fields: [terapeuta_id], references: [id], onDelete: Restrict)
  cliente             cliente             @relation(fields: [cliente_id], references: [id], onDelete: Restrict)
  trials              sessao_trial[]

  @@index([terapeuta_id, data_criacao])
  @@index([ocp_id])
}

model estimulo {
  id                  Int                 @id @default(autoincrement())
  nome                String              @unique
  descricao           String?             @db.Text

  ocps                estimulo_ocp[]
}

model estimulo_ocp {
  id                  Int                 @id @default(autoincrement())
  id_estimulo         Int
  id_ocp              Int
  nome                String?
  descricao           String?             @db.Text
  status              Boolean

  estimulo            estimulo            @relation(fields: [id_estimulo], references: [id], onDelete: Cascade)
  ocp                 ocp                 @relation(fields: [id_ocp], references: [id], onDelete: Cascade)
  trials              sessao_trial[]
}

model ocp {
  id                  Int                 @id @default(autoincrement())
  cliente_id          String              @db.Char(36)
  criador_id          String              @db.Char(36)
  nome_programa       String
  criado_em           DateTime            @default(now())
  data_inicio         DateTime
  data_fim            DateTime
  objetivo_programa   String?
  objetivo_descricao  String?             @db.Text
  dominio_criterio    String?             @db.Text
  observacao_geral    String?             @db.Text
  atualizado_em       DateTime            @updatedAt
  status              String              @default("active")

  cliente             cliente             @relation(fields: [cliente_id], references: [id], onDelete: Restrict)
  criador             terapeuta           @relation("CriadorOcp", fields: [criador_id], references: [id], onDelete: Restrict)
  sessoes             sessao[]
  estimulo_ocp        estimulo_ocp[]

  @@index([cliente_id])
  @@index([nome_programa])
}

model terapeuta_cliente {
  id                  Int                 @id @default(autoincrement())
  terapeuta_id        String              @db.Char(36)
  cliente_id          String              @db.Char(36)

  terapeuta           terapeuta           @relation(fields: [terapeuta_id], references: [id], onDelete: Cascade)
  cliente             cliente             @relation(fields: [cliente_id], references: [id], onDelete: Cascade)

  @@unique([terapeuta_id, cliente_id])
}

enum escola_tipo_escola {
  particular
  publica
}

enum cliente_responsavel_parentesco {
  mae
  pai
  responsavel_legal
  outro
}

enum pagamento_contatos_categoria {
  geral
  advogado
  outro
}

enum pagamento_contatos_tipo {
  telefone
  email
}

enum pagamentos_tipo_sistema {
  reembolso
  liminar
  particular
}

enum cliente_status {
  ativo
  inativo
}